# ๐ Pagination Architecture

## Request Flow

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                         FRONTEND                                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                 โ
โ  User clicks "Next Page"  โ  setPage(2)                       โ
โ                                                                 โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ     โ
โ  โ  fetch('/api/products?page=2&limit=20')              โ     โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ     โ
โ                           โ                                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    BACKEND CONTROLLER                           โ
โ                   (product.controller.ts)                       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                 โ
โ  @Get()                                                         โ
โ  getAllProducts(                                                โ
โ    @Query('page') page = 1,    โ Parse query params           โ
โ    @Query('limit') limit = 20                                  โ
โ  )                                                              โ
โ                           โ                                     โ
โ  productService.getAllProducts(page, limit)                    โ
โ                                                                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                   PRODUCT SERVICE                               โ
โ                   (product.service.ts)                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                 โ
โ  getAllProducts(page?, limit?) {                               โ
โ    return getProductsService                                    โ
โ           .getAllProducts(page, limit)                         โ
โ  }                                                              โ
โ                           โ                                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                 GET PRODUCTS SERVICE                            โ
โ                (getproducts.service.ts)                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                 โ
โ  1. Validate inputs                                            โ
โ     โโ page = max(1, page)                                     โ
โ     โโ limit = min(max(1, limit), 100)                        โ
โ                                                                 โ
โ  2. Calculate skip                                             โ
โ     skip = (page - 1) * limit                                  โ
โ     Example: page=2, limit=20 โ skip=20                       โ
โ                                                                 โ
โ  3. Get total count                                            โ
โ     totalCount = await prisma.product.count(...)              โ
โ                                                                 โ
โ  4. Query database with pagination                             โ
โ     prisma.product.findMany({                                  โ
โ       skip: 20,        โ Skip first 20 items                  โ
โ       take: 20,        โ Take next 20 items                   โ
โ       orderBy: { createdAt: 'desc' }                          โ
โ     })                                                         โ
โ                                                                 โ
โ  5. Calculate metadata                                         โ
โ     totalPages = ceil(totalCount / limit)                     โ
โ     hasNextPage = page < totalPages                           โ
โ     hasPreviousPage = page > 1                                โ
โ                                                                 โ
โ  6. Return structured response                                 โ
โ                                                                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                      DATABASE (PostgreSQL)                      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                 โ
โ  SELECT * FROM products                                         โ
โ  WHERE isActive = true                                          โ
โ  ORDER BY createdAt DESC                                        โ
โ  OFFSET 20        โ Skip 20 (from page 2)                      โ
โ  LIMIT 20         โ Return 20 items                            โ
โ                                                                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                      RESPONSE TO FRONTEND                       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                 โ
โ  {                                                              โ
โ    "data": [                                                    โ
โ      { id: 21, title: "Product 21", ... },                    โ
โ      { id: 22, title: "Product 22", ... },                    โ
โ      ...20 items total...                                      โ
โ      { id: 40, title: "Product 40", ... }                     โ
โ    ],                                                           โ
โ    "pagination": {                                              โ
โ      "page": 2,                                                 โ
โ      "limit": 20,                                               โ
โ      "totalCount": 150,                                         โ
โ      "totalPages": 8,                                           โ
โ      "hasNextPage": true,                                       โ
โ      "hasPreviousPage": true                                    โ
โ    }                                                            โ
โ  }                                                              โ
โ                                                                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                         FRONTEND                                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                 โ
โ  User sees products 21-40                                      โ
โ  "Previous" button enabled  (page > 1)                         โ
โ  "Next" button enabled      (page < 8)                         โ
โ  Shows: "Page 2 of 8 (150 total products)"                    โ
โ                                                                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## Data Flow Example

### Scenario: 150 products total, showing 20 per page

| Page | Skip | Take | Shows Items | Has Previous | Has Next |
| ---- | ---- | ---- | ----------- | ------------ | -------- |
| 1    | 0    | 20   | 1-20        | โ           | โ       |
| 2    | 20   | 20   | 21-40       | โ           | โ       |
| 3    | 40   | 20   | 41-60       | โ           | โ       |
| ...  | ...  | ...  | ...         | ...          | ...      |
| 8    | 140  | 20   | 141-150     | โ           | โ       |

---

## Validation Logic

```typescript
// Input: page = -1, limit = 500
// After validation:
const validatedPage = Math.max(1, -1); // = 1
const validatedLimit = Math.min(
  // = 100
  Math.max(1, 500), // = 500
  100, // cap at 100
);
```

---

## Skip Calculation

```
skip = (page - 1) ร limit

Examples:
- Page 1, Limit 20: (1-1) ร 20 = 0    โ Start from first item
- Page 2, Limit 20: (2-1) ร 20 = 20   โ Skip first 20 items
- Page 3, Limit 20: (3-1) ร 20 = 40   โ Skip first 40 items
- Page 5, Limit 15: (5-1) ร 15 = 60   โ Skip first 60 items
```

---

## Total Pages Calculation

```
totalPages = โtotalCount รท limitโ

Examples:
- 150 items, 20 per page: โ150 รท 20โ = โ7.5โ = 8 pages
- 100 items, 20 per page: โ100 รท 20โ = โ5โ   = 5 pages
- 99 items,  20 per page: โ99 รท 20โ  = โ4.95โ = 5 pages
```

---

## Frontend State Management

```typescript
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ          Component State                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  const [page, setPage] = useState(1)         โ
โ                                              โ
โ  User clicks "Next" โโโโ setPage(2)        โ
โ                     โ                        โ
โ  useEffect triggers โโ fetch new data       โ
โ                     โ                        โ
โ  Update products โโโโ setProducts(newData)  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## Performance Comparison

### Before (No Pagination)

```
Query: SELECT * FROM products  (all 10,000 rows)
Response Size: 15 MB
Load Time: 5-10 seconds
Memory: High
```

### After (With Pagination)

```
Query: SELECT * FROM products OFFSET 0 LIMIT 20
Response Size: 30 KB
Load Time: 100-200ms
Memory: Low
```

**Improvement: 99% reduction in response size, 95% faster load time**

---

## Error Handling

```typescript
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  Invalid Input                           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  page = "abc"  โ  Parsed as NaN         โ
โ               โ  Default to 1            โ
โ                                          โ
โ  limit = null  โ  Default to 20         โ
โ                                          โ
โ  page = -5     โ  Math.max(1, -5) = 1   โ
โ                                          โ
โ  limit = 999   โ  Math.min(999, 100)    โ
โ                โ  Capped at 100          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## Caching Strategy

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  SWR Cache                                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  /products?page=1  โ [cached data]         โ
โ  /products?page=2  โ [cached data]         โ
โ  /products?page=3  โ [loading...]          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

Each page is cached independently!
```
